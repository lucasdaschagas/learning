/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2018 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.video");if(!b.video.MediaError){b.video.MediaError={MEDIA_ERR_CUSTOM:"MEDIA_ERR_CUSTOM",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_ENCRYPTED:"MEDIA_ERR_ENCRYPTED"}}if(!b.video.BaseVideoProxy){var d={MEDIA_ERR_ABORTED:"Media playback is aborted by the user",MEDIA_ERR_NETWORK:"A network error caused the media download to fail part-way.",MEDIA_ERR_DECODE:"The media playback was aborted due to a corruption problem or because the media used features user's browser did not support.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The media could not be loaded, either because the server or network failed or because the format is not supported.",MEDIA_ERR_ENCRYPTED:"The media is encrypted and we do not have the keys to decrypt it."};var a=[b.video.MediaError.MEDIA_ERR_CUSTOM,b.video.MediaError.MEDIA_ERR_ABORTED,b.video.MediaError.MEDIA_ERR_NETWORK,b.video.MediaError.MEDIA_ERR_DECODE,b.video.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED,b.video.MediaError.MEDIA_ERR_ENCRYPTED];b.video.BaseVideoProxy=function c(m,q,e,r,g,f,k,l,h,p,n,o,j){this.serverUrl=e;this.aemmode=o;this.videoServerUrl=r;this.curTime=0;this.bufTime=0;this.serverDuration=0;this.videoDuration=0;this.fallbackmessage=n;this.volume=1;this.mutedValue=p;this.playback=f;this.progressivebitrate=k*1024;this.width=m;this.height=q;this.callQueue=[];this.proxyIsReady=false;this.loop=l;this.preload=h;this.autoPlay=g;this.isDisposed=false;this.firstAsset=true;this.videoElement=null;this.videoWidth=0;this.videoHeight=0;this.useCORS=j;this.errorNotificationSent=false;this.createVideoElement()};b.video.BaseVideoProxy.prototype.getDurationFromItem=function(f){if(f.type==b.ItemDescType.VIDEO_SET){var e=f.items[0];if(e.userData&&e.userData.Video_Length){return parseFloat(e.userData.Video_Length)*1000}else{if((e.userData instanceof Array)&&e.userData[0].Video_Length){return parseFloat(e.userData[0].Video_Length)*1000}}}else{if(f.userData&&f.userData.Video_Length){return parseFloat(f.userData.Video_Length)*1000}else{if((f.userData instanceof Array)&&f.userData[0].Video_Length){return parseFloat(f.userData[0].Video_Length)*1000}}}return undefined};b.video.BaseVideoProxy.prototype.getVideoElement=function(){return this.videoElement};b.video.BaseVideoProxy.prototype.createVideoElement=function(){if(this.videoElement){this.curTime=0;this.bufTime=0;this.serverDuration=0;this.videoDuration=0;this.videoElement=null}this.videoElement=b.Util.createObj(null,"video",null,null);this.videoElement.setAttribute("tabindex",-1);if(this.useCORS){this.videoElement.setAttribute("crossOrigin","anonymous")}if(this.mutedValue){this.videoElement.setAttribute("muted","")}this.videoElement.volume=this.volume;this.videoElement.muted=this.mutedValue;this.videoElement.style.position="absolute";this.resize(this.width,this.height);this.videoElement.preload=this.preload?"auto":"none";if(this.autoPlay){this.videoElement.autoplay=true}if(this.playback.controls){this.videoElement.controls=true}else{if(("ipad"==b.browser.device.name)||(("blackberry"==b.browser.device.name)&&(b.browser.device.version==10))){this.videoElement.setAttribute("webkit-playsinline",1)}}if(this.loop){this.videoElement.loop=true}this.videoElement.classList.add("s7videoelement");this.addVideoElementEventListeners()};b.video.BaseVideoProxy.prototype.addVideoElementEventListeners=function(){var e=this;b.Event.addDOMListener(this.videoElement,"timeupdate",function(){if(e.isDisposed){return}if(b.browser.name=="ie"){e.isbuffering=false;e.onBuffering(false)}var f=e.curTime;e.curTime=e.videoElement.currentTime;if(e.videoElement.ended&&(e.videoDuration!=e.curTime)){e.curTime=e.videoDuration}if(f!=e.curTime){e.onCurrentTime()}},{capture:true});b.Event.addDOMListener(this.videoElement,"loadstart",function(){if(e.isDisposed){return}e.onLoadProgress()},{capture:true});b.Event.addDOMListener(this.videoElement,"canplay",function(){if(e.isDisposed){return}e.isbuffering=false;e.onBuffering(false)},{capture:true});b.Event.addDOMListener(this.videoElement,"waiting",function(){if(e.isDisposed){return}e.isbuffering=true;e.onBuffering(true)},{capture:true});b.Event.addDOMListener(this.videoElement,"loadedmetadata",function(){if(e.isDisposed){return}var f=false;if(!e.videoWidth&&!e.videoHeight){f=true;e.videoWidth=this.videoWidth;e.videoHeight=this.videoHeight;e.resize(e.getWidth(),e.getHeight())}e.proxyIsReady=true;while(e.callQueue.length>0){var g=e.callQueue[0];e.callQueue.splice(0,1);e[g.func].apply(e,g.args)}e.onLoadProgress();if(f){e.onVideoDimension()}},{capture:true});b.Event.addDOMListener(this.videoElement,"progress",function(){if(e.isDisposed){return}e.onLoadProgress()},{capture:true});b.Event.addDOMListener(this.videoElement,"durationchange",function(){if(e.isDisposed){return}var f=e.videoElement.duration;if(("android"==b.browser.device.name)&&(4==b.browser.device.version)&&(e.videoElement.readyState<4)){return}if((b.browser.name=="safari")&&(e.serverDuration)&&((f==Math.floor(e.serverDuration))||(f==Math.ceil(e.serverDuration)))){f=e.serverDuration}if(f!=e.videoDuration){e.videoDuration=f;e.onDuration()}},{capture:true});b.Event.addDOMListener(this.videoElement,"volumechange",function(){if(e.isDisposed){return}e.onVolume()},{capture:true});b.Event.addDOMListener(this.videoElement,"seeked",function(){if(e.isDisposed){return}if(b.browser.name=="ie"){e.isbuffering=false;e.onBuffering(false)}e.onSeeked()},{capture:true});b.Event.addDOMListener(this.videoElement,"play",function(){if(e.isDisposed){return}e.onStateChange()},{capture:true});b.Event.addDOMListener(this.videoElement,"pause",function(){if(e.isDisposed){return}e.onStateChange()},{capture:true});b.Event.addDOMListener(this.videoElement,"ended",function(){if(e.isDisposed){return}if(e.videoDuration!=e.curTime){e.curTime=e.videoDuration}e.onCurrentTime();e.onStateChange()},{capture:true});b.Event.addDOMListener(this.videoElement,"loadeddata",function(){if(e.isDisposed){return}e.onViewReady()},{capture:true});b.Event.addDOMListener(this.videoElement,"error",function(){if(e.isDisposed){return}var f=e.getMediaError();if(!f){return}e.errorNotificationSent=true;e.onPlaybackError(f)},{capture:true})};b.video.BaseVideoProxy.prototype.getVolume=function(){return this.videoElement.volume};b.video.BaseVideoProxy.prototype.setVolume=function(e){if(this.videoElement.muted){this.mutedValue=this.videoElement.muted=false}this.volume=e;this.videoElement.volume=e};b.video.BaseVideoProxy.prototype.mute=function(e){this.mutedValue=this.videoElement.muted=e};b.video.BaseVideoProxy.prototype.muted=function(){return this.videoElement.muted};b.video.BaseVideoProxy.prototype.getLoadedPosition=function(){return((this.videoElement.buffered&&this.videoElement.buffered.length>0)?this.videoElement.buffered.end(0)*1000:0)};b.video.BaseVideoProxy.prototype.getDuration=function(){if(b.Util.isNull(this.videoDuration)){return undefined}else{return this.videoDuration*1000}};b.video.BaseVideoProxy.prototype.getVideoWidth=function(){return this.videoWidth};b.video.BaseVideoProxy.prototype.getVideoHeight=function(){return this.videoHeight};b.video.BaseVideoProxy.prototype.ended=function(){return this.videoElement.ended};b.video.BaseVideoProxy.prototype.getWidth=function(){return this.width};b.video.BaseVideoProxy.prototype.getHeight=function(){return this.height};b.video.BaseVideoProxy.prototype.play=function(){this.videoElement.play()};b.video.BaseVideoProxy.prototype.paused=function(){return this.videoElement.paused};b.video.BaseVideoProxy.prototype.pause=function(){if(this.isbuffering){this.isbuffering=false;this.onBuffering(false)}this.videoElement.pause()};b.video.BaseVideoProxy.prototype.getCurrentTime=function(){return this.curTime*1000};b.video.BaseVideoProxy.prototype.dispose=function(){if(this.videoElement){this.videoElement.pause();this.videoElement.removeAttribute("src");this.videoElement.load();if(this.videoElement.parentElement){this.videoElement.parentElement.removeChild(this.videoElement)}}this.isDisposed=true};b.video.BaseVideoProxy.prototype.getMediaError=function(){var e=this.videoElement.error;if(!e||e.code==undefined||!a[e.code]){return e}var f=a[e.code];return{type:f,message:d[f]}};b.video.BaseVideoProxy.prototype.resize=function(f,g){var e,h;this.width=f;this.height=g;if(this.videoHeight&&this.videoWidth){e=f*this.videoHeight/this.videoWidth;if(e>g){h=this.videoWidth*g/this.videoHeight;e=g}else{h=f}}else{e=g;h=f}this.videoElement.width=h*b.browser.device.pixelratio;this.videoElement.height=e*b.browser.device.pixelratio;this.videoElement.style.width=h+"px";this.videoElement.style.height=e+"px";this.videoElement.style.left=(f-h)/2+"px";this.videoElement.style.top=(g-e)/2+"px"};b.video.BaseVideoProxy.prototype.seek=function(f){if(!this.proxyIsReady){this.fillMethodQueue("seek",[f]);return}var e=(!this.videoElement.paused);this.videoElement.currentTime=f/1000;this.curTime=f/1000;if((b.browser.device.name=="ipad")&&(b.browser.device.version==6)&&f==0){if(e){this.videoElement.play()}}};b.video.BaseVideoProxy.prototype.setVideoDimensionFromItem=function(e){if(e.items){this.videoWidth=e.items[0].width;this.videoHeight=e.items[0].height}else{if(e.width){this.videoWidth=e.width;this.videoHeight=e.height}}};b.video.BaseVideoProxy.prototype.onLoadProgress=function(){};b.video.BaseVideoProxy.prototype.onCurrentTime=function(){};b.video.BaseVideoProxy.prototype.onDuration=function(){};b.video.BaseVideoProxy.prototype.onVideoDimension=function(){};b.video.BaseVideoProxy.prototype.onSeeked=function(){};b.video.BaseVideoProxy.prototype.onVolume=function(){};b.video.BaseVideoProxy.prototype.onStateChange=function(){};b.video.BaseVideoProxy.prototype.onViewReady=function(){};b.video.BaseVideoProxy.prototype.resolveVideoAsset=function(v,e,m,p,t){var g=!p&&(v.name.indexOf("?")!=-1)?v.name.split("?")[0]:v.name;var r=(/^((http|https):\/\/[^\/]*)\b(\/DMGateway\/(private-ssl|private)\/)/.test(t));var h=e.type;var l=h===b.video.playbackType.AUTO||h===b.video.playbackType.HLS||h===b.video.playbackType.DASH;if(v.type==b.ItemDescType.VIDEO_GROUP&&p){if(l&&!r){throw new Error("Sets with type 'video_group'("+v.type+") could not be played by this video proxy.")}return b.MediaSetParser.formNonAVS(v.items,m)}var f=!r&&l&&v.videoType!==b.VideoDescType.PATH;var j=typeof(MediaSource)!=="undefined";var q=b.MediaSetParser.getAllowedVideoCodecs(v);var n=b.MediaSetParser.isDashStreamingAllowed(v);var k="safari"===b.browser.name||"ipad"===b.browser.device.name||"iphone"===b.browser.device.name;var u=q.indexOf("avc1")>-1||q.indexOf("hev1")>-1;var o=k&&u;var s=o||(j&&(h===b.video.playbackType.HLS||!n));if(f&&s){return g+".m3u8?packagedStreaming=true"}if(f&&j&&n){return g+".mpd"}if(v.type==b.ItemDescType.VIDEO_SET){return b.MediaSetParser.getAssetByNearestBitrate(v.items,m)}return g};b.video.BaseVideoProxy.prototype.resolvePosterUrl=function(l,g,m,n,h){var f=(l!=undefined)?l:g;var e="";if(f==""||f.indexOf("?")==0){e=f;if(m){f=n.name}else{if(n.hasOwnProperty("image")&&n.image){f=this.parseMovieUrl(n.image.name)}else{f=this.parseMovieUrl(n.name)}}}var p=null;if(f!=null&&f!=""&&f!="none"){var j=(f.indexOf("?")>=0)?"&":"?";if(e!=""){if(e.indexOf("?")==0){j=e}else{j+=e}j+="&"}if(h){var o=null;if(n.type==b.ItemDescType.VIDEO_SET){o=n.items[0];for(var k=0;k<n.items.length;k++){if(n.items[k].height>=o.height){o=n.items[k]}}}else{o=n}j+="fit=constrain,1&wid="+o.width+"&hei="+o.height}else{j+="fit=constrain,1&wid="+this.width+"&hei="+this.height}p=f+j}return p};b.video.BaseVideoProxy.prototype.parseMovieUrl=function(g){var e=null;if(g){e=g.replace(/[\\]/g,"/");var f=e.split(/\.(mp4|f4v|flv|webm)/i);if(f.length>1){e=f[0]}f=e.split(":");if(f.length>1){e=f[1]}f=e.split("/");e=f.length>1?f[0]+"/"+f[f.length-1]:e}return e};b.video.BaseVideoProxy.prototype.fillMethodQueue=function(f,e){this.callQueue.push({func:f,args:e})};b.video.BaseVideoProxy.prototype.getOrigin=function(e){var f=window.document.createElement("a");f.href=e;return f.protocol+f.hostname+f.port};b.video.BaseVideoProxy.prototype.fixSafariCrossOrigin=function(e){if(this.videoElement&&this.useCORS){this.videoElement.removeAttribute("crossOrigin");if((this.getOrigin(e)!==this.getOrigin(window.location.href))||this.playback.type!==b.video.playbackType.PROGRESSIVE){this.videoElement.setAttribute("crossOrigin","anonymous")}}};b.video.BaseVideoProxy.prototype.getIsProxyready=function(){return this.proxyIsReady};b.video.BaseVideoProxy.prototype.getCurrentSrc=function(){return this.videoElement?this.videoElement.currentSrc:""};b.video.BaseVideoProxy.prototype.isNativePlayback=function(){return true};b.video.BaseVideoProxy.prototype.refresh=function(){}}if(!b.video.HTML5VideoProxy){b.video.HTML5VideoProxy=function HTML5VideoProxy(m,p,e,r,g,f,k,l,h,q,n,o,j){b.Logger.log(b.Logger.INFO,"HTML5VideoProxy constructor");arguments.callee.superclass.apply(this,[m,p,e,r,g,f,k,l,h,q,n,o,j])};b.Class.inherits("s7sdk.video.HTML5VideoProxy","s7sdk.video.BaseVideoProxy");b.video.HTML5VideoProxy.prototype.setVideo=function(f,e){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;var k;this.firstAsset=false;var j=this;if(e!=null){this.videoElement.poster=e;var h=new Image();b.Event.addDOMListener(h,"load",function(){j.onViewReady()},{capture:true});h.src=e}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}this.videoElement.load();var g=document.createElement("p");g.innerText=this.fallbackmessage;this.videoElement.appendChild(g);if(b.browser.name=="safari"){this.fixSafariCrossOrigin(f)}var l=document.createElement("source");l.src=f;this.videoElement.appendChild(l);if(b.browser.name=="safari"){l.setAttribute("type","video/mp4")}this.resize(this.width,this.height)};b.video.HTML5VideoProxy.prototype.setAsset=function(f,e){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;this.serverDuration=this.getDurationFromItem(f)/1000;if(this.serverDuration){this.videoDuration=this.serverDuration}var m=this.resolveVideoAsset(f,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);this.setVideoDimensionFromItem(f);this.firstAsset=false;var k=this;if(e!=null){this.videoElement.poster=b.Util.resolveURL(this.serverUrl,e);var j=new Image();b.Event.addDOMListener(j,"load",function(){k.onViewReady()},{capture:true});j.src=b.Util.resolveURL(this.serverUrl,e)}var h;if(b.Util.isArray(m)){h=[];for(i=0;i<m.length;i++){h[i]=b.Util.resolveURL(this.videoServerUrl,m[i])}}else{h=b.Util.resolveURL(this.videoServerUrl,m)}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}var g=document.createElement("p");g.innerText=this.fallbackmessage;this.videoElement.appendChild(g);if(b.browser.name=="safari"){this.fixSafariCrossOrigin(this.videoServerUrl)}var l;if(b.Util.isArray(h)){for(i=0;i<h.length;i++){l=document.createElement("source");l.src=h[i];this.videoElement.appendChild(l)}}else{l=document.createElement("source");l.src=h;this.videoElement.appendChild(l)}if(b.browser.name=="safari"){l.setAttribute("type","video/mp4")}this.resize(this.width,this.height);this.onVideoDimension()}}if(!b.video.IPhoneProxy){b.video.IPhoneProxy=function IPhoneProxy(q,m,p,e,s,g,f,l,k,h,r,n,o,j){b.Logger.log(b.Logger.INFO,"IPhoneProxy constructor");arguments.callee.superclass.apply(this,[m,p,e,s,g,f,l,k,h,r,n,o,j]);this.container=q;this.createPosterElement(m,p)};b.Class.inherits("s7sdk.video.IPhoneProxy","s7sdk.video.BaseVideoProxy");b.video.IPhoneProxy.prototype.createVideoElement=function(){if(this.videoElement){this.curTime=0;this.bufTime=0;this.serverDuration=0;this.videoDuration=0;this.videoElement=null}this.videoElement=b.Util.createObj(null,"video",null,null);this.videoElement.preload=this.preload?"auto":"none";this.videoElement.setAttribute("tabindex",-1);if(this.playback.controls){this.videoElement.controls=true}if(this.useCORS){this.videoElement.setAttribute("crossOrigin","anonymous")}if(this.mutedValue){this.videoElement.setAttribute("muted","")}if(this.autoPlay){this.videoElement.autoplay=true}this.videoElement.muted=this.mutedValue;this.videoElement.style.position="absolute";this.isCanPlaysInline=b.browser.device.version>=10;if(this.isCanPlaysInline){this.videoElement.setAttribute("playsinline",1)}else{this.videoElement.style.width="1px";this.videoElement.style.height="1px"}var e=document.createElement("p");e.innerText=this.fallbackmessage;this.videoElement.appendChild(e);if(this.loop){this.videoElement.loop=true}this.videoElement.classList.add("s7videoelement");this.addVideoElementEventListeners()};b.video.IPhoneProxy.prototype.createPosterElement=function(e,f){if(!this.isCanPlaysInline){if(this.divPosterElement&&(this.divPosterElement.parentElement!=null)){this.divPosterElement.parentElement.removeChild(this.divPosterElement)}this.divPosterElement=b.Util.createObj(null,"div",null,null);this.divPosterElement.className="s7videoposter";this.divPosterElement.style.width=e+"px";this.divPosterElement.style.height=f+"px"}};b.video.IPhoneProxy.prototype.setAsset=function(g,e){var k=this.resolveVideoAsset(g,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);this.setVideoDimensionFromItem(g);this.serverDuration=this.getDurationFromItem(g)/1000;if(this.serverDuration){this.videoDuration=this.serverDuration}if(!this.firstAsset){this.createPosterElement(this.width,this.height)}this.firstAsset=false;var f=this;b.Event.addDOMListener(this.videoElement,"webkitendfullscreen",function(l){f.onStateChange()});if(e!=null&&this.divPosterElement){this.divPosterElement.style.backgroundImage="url('"+b.Util.resolveURL(this.serverUrl,e)+"')";this.videoElement.parentElement.insertBefore(this.divPosterElement,this.videoElement)}var h;if(b.Util.isArray(k)){h=[];for(i=0;i<k.length;i++){h[i]=b.Util.resolveURL(this.videoServerUrl,k[i])}}else{h=b.Util.resolveURL(this.videoServerUrl,k)}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}if(b.browser.name=="safari"){this.fixSafariCrossOrigin(this.videoServerUrl)}var j;if(b.Util.isArray(h)){for(i=0;i<h.length;i++){j=document.createElement("source");j.src=h[i];this.videoElement.appendChild(j)}}else{j=document.createElement("source");j.src=h;this.videoElement.appendChild(j)}if(b.browser.name=="safari"){j.setAttribute("type","video/mp4")}if(e!=null&&!this.divPosterElement){this.videoElement.poster=b.Util.resolveURL(this.serverUrl,e)}this.resize(this.width,this.height);if(this.preload){this.videoElement.load()}this.onVideoDimension()};b.video.IPhoneProxy.prototype.setVideo=function(h,e){if(!this.firstAsset){this.createPosterElement(this.width,this.height)}this.firstAsset=false;var f=this;b.Event.addDOMListener(this.videoElement,"webkitendfullscreen",function(j){f.onStateChange()});if(this.divPosterElement){this.divPosterElement.style.backgroundImage=e?"url('"+e+"')":"none";this.videoElement.parentElement.insertBefore(this.divPosterElement,this.videoElement)}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}if(b.browser.name=="safari"){this.fixSafariCrossOrigin(h)}var g=document.createElement("source");g.src=h;this.videoElement.appendChild(g);if(b.browser.name=="safari"){g.setAttribute("type","video/mp4")}if(!this.divPosterElement){this.videoElement.poster=e?e:""}this.resize(this.width,this.height);if(this.preload){this.videoElement.load()}};b.video.IPhoneProxy.prototype.getVolume=function(){return 1};b.video.IPhoneProxy.prototype.setVolume=function(e){};b.video.IPhoneProxy.prototype.mute=function(e){};b.video.IPhoneProxy.prototype.resize=function(f,g){this.width=f;this.height=g;if(this.isCanPlaysInline){var e,h;this.width=f;this.height=g;if(this.videoHeight&&this.videoWidth){e=f*this.videoHeight/this.videoWidth;if(e>g){h=this.videoWidth*g/this.videoHeight;e=g}else{h=f}}else{e=g;h=f}this.videoElement.width=h*b.browser.device.pixelratio;this.videoElement.height=e*b.browser.device.pixelratio;this.videoElement.style.width=h+"px";this.videoElement.style.height=e+"px";this.videoElement.style.left=(f-h)/2+"px";this.videoElement.style.top=(g-e)/2+"px"}if(this.divPosterElement){this.divPosterElement.style.width=f+"px";this.divPosterElement.style.height=g+"px"}};b.video.IPhoneProxy.prototype.seek=function(e){this.videoElement.currentTime=e/1000};b.video.IPhoneProxy.prototype.dispose=function(){if(this.divPosterElement&&(this.divPosterElement.parentElement!=null)){this.divPosterElement.parentElement.removeChild(this.divPosterElement);this.divPosterElement=null}this.superclass.prototype.dispose.apply(this)}}if(!b.video.VideojsProxy){window.VIDEOJS_NO_DYNAMIC_STYLE=true;b.video.VideojsProxy=function VideojsProxy(o,r,e,t,g,f,l,n,k,h,s,p,q,j){b.Util.require("s7sdk.libs.videojs.video");arguments.callee.superclass.apply(this,[o,r,e,t,g,f,l,k,h,s,p,q,j]);b.Logger.log(b.Logger.INFO,"VideojsProxy constructor");this.videojsPlayer=null;this.initialbitrate=n*1024;this.lastSegmentBandwidth=0;var m=this;this.loadVideoJsAndProcessQueue=function(){if(b.libs&&b.libs.videojs&&b.libs.videojs.videojs){clearTimeout(m.videojsLoadTimer);m.videojsLoadTimer=null;while(m.callQueue.length>0){var u=m.callQueue[0];m.callQueue.splice(0,1);m[u.func].apply(m,u.args)}}else{clearTimeout(m.videojsLoadTimer);m.videojsLoadTimer=setTimeout(m.loadVideoJsAndProcessQueue,100)}};this.loadVideoJsAndProcessQueue()};b.Class.inherits("s7sdk.video.VideojsProxy","s7sdk.video.BaseVideoProxy");b.video.VideojsProxy.prototype.createVideojsPlayer=function(){if(!b.libs||!b.libs.videojs||!b.libs.videojs.videojs){return}if(!this.videoElement.classList.contains("video-js")){this.videoElement.classList.add("video-js")}this.videojsPlayer=new b.libs.videojs.videojs(this.videoElement,{controls:false,nativeControlsForTouch:this.playback.controls,autoplay:this.autoPlay,preload:this.preload?"auto":"none",children:[],responsive:true,html5:{vhs:{bandwidth:this.initialbitrate}}});var e=this;this.videojsPlayer.on("error",function(){if(!e.errorNotificationSent){var g=e.videojsPlayer.error();var h={type:a[g.code],message:g.message};e.onPlaybackError(h)}e.errorNotificationSent=false});var f=this.videoElement.parentElement;if(f.classList.contains("video-js")){f.style.top="0px";f.style.left="0px";f.style.width="100%";f.style.height="100%";f.classList.add("s7videoelement");this.videoElement.style.transition="";this.videoElement.style.transform="";this.videoElement.style.visibility=""}this.videoElement.style.left="0px";this.videoElement.style.top="0px";this.videoElement.style.width="100%";this.videoElement.style.height="100%";this.videojsPlayer.one("loadedmetadata",this.initQualityChangeWatcher.bind(this))};b.video.VideojsProxy.prototype.dispose=function(){if(this.videojsLoadTimer){clearTimeout(this.videojsLoadTimer);this.videojsLoadTimer=null}if(this.videojsPlayer){this.videojsPlayer.dispose()}this.superclass.prototype.dispose.apply(this)};b.video.VideojsProxy.prototype.refresh=function(){if(this.videojsPlayer){this.curTime=0;this.bufTime=0;this.serverDuration=0;this.videoDuration=0;this.videojsPlayer.dispose();this.videojsPlayer=null}};b.video.VideojsProxy.prototype.setAsset=function(f,e){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;var h=this;if(e!=null){this.videoElement.poster=b.Util.resolveURL(this.serverUrl,e);var g=new Image();b.Event.addDOMListener(g,"load",function(){h.onViewReady()},{capture:true});g.src=b.Util.resolveURL(this.serverUrl,e)}this.firstAsset=false;var k=this.resolveVideoAsset(f,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);this.setVideoDimensionFromItem(f);var j=b.Util.resolveURL(this.videoServerUrl,k);this.createVideojsPlayer();if(this.videojsPlayer){this.videojsPlayer.src(j)}else{this.fillMethodQueue("setAsset",[f])}this.resize(this.width,this.height);this.onVideoDimension()};b.video.VideojsProxy.prototype.setVideo=function(h,e){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;this.firstAsset=false;var g=this;if(e!=null){this.videoElement.poster=e;var f=new Image();b.Event.addDOMListener(f,"load",function(){g.onViewReady()},{capture:true});f.src=e}this.createVideojsPlayer();if(this.videojsPlayer){this.videojsPlayer.src(h)}else{this.fillMethodQueue("setVideo",[h])}this.resize(this.width,this.height)};b.video.VideojsProxy.prototype.resize=function(f,g){var e,h;this.width=f;this.height=g;if(this.videoHeight&&this.videoWidth){e=f*this.videoHeight/this.videoWidth;if(e>g){h=this.videoWidth*g/this.videoHeight;e=g}else{h=f}}else{e=g;h=f}if(this.videojsPlayer){this.videojsPlayer.width(h);this.videojsPlayer.height(e)}};b.video.VideojsProxy.prototype.initQualityChangeWatcher=function(){var g=this.videojsPlayer.textTracks();if(!g){return}var e=this;var f;for(f=0;f<g.length;f++){if(g[f].label==="segment-metadata"){var h=g[f];h.on("cuechange",function(){var j=h.activeCues[0];if(!j||!j.value){return}if(e.lastSegmentBandwidth!==j.value.bandwidth){if(e.lastSegmentBandwidth&&e.onQualityChange){e.onQualityChange({selectedBitrate:j.value.bandwidth})}e.lastSegmentBandwidth=j.value.bandwidth}})}}};b.video.VideojsProxy.prototype.getStats=function(){var e=this.videojsPlayer.tech({});var f=e&&e.vhs.stats;if(!f){return{}}return{averageBandwidthDelivered:Math.round((f.mediaBytesTransferred*1000)/(f.mediaTransferDuration*1024))}};b.video.VideojsProxy.prototype.getCurrentSrc=function(){return this.videojsPlayer?this.videojsPlayer.currentSrc():""};b.video.VideojsProxy.prototype.isNativePlayback=function(){return false}}})(s7getCurrentNameSpace());