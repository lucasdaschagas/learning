/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2017 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.set");b.Util.require("s7sdk.common.IS");b.Util.require("s7sdk.event.Event");b.Util.require("s7sdk.common.SwatchImageRenderer");b.Util.require("s7sdk.utils.SwatchesParser");b.Util.require("s7sdk.common.ItemDesc");b.Util.require("s7sdk.common.SwatchesLayout");b.Util.require("s7sdk.common.Button");if(!b.set.Swatches2Control){b.set.Swatches2Control=function(c){arguments.callee.superclass.apply(this,[c,b.set.Swatches2Control.NS,c.constructor,b.set.Swatches2.RESTRICTED_STYLES])};b.set.Swatches2Control.NS="s7sdk.set.Swatches2Control"}b.Class.inherits(b.set.Swatches2Control.NS,"s7sdk.ControlComponent");if(!b.set.Swatches2){b.set.Swatches2=function Swatches2(c,f,e){b.Logger.log(b.Logger.CONFIG,"s7sdk.set.Swatches2 constructor - container: %0, settings: %1 , compId: %2",c,f,e);var g=!!arguments[3];e=(typeof e=="string"&&e.length)?e:"Swatches2_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[e,c,"div","s7swatches2",f]);this.container=this.getParent();this.width=parseInt(b.Util.css.getCss("s7swatches2","width",this.id,null,this.container));this.height=parseInt(b.Util.css.getCss("s7swatches2","height",this.id,null,this.container));this.prevButton=null;this.nextButton=null;this.focusedSwatchIdx=null;this.mediaSetDesc=null;this.swatches=[];this.locale=this.getParam("locale","");this.selectedSwatchIdx=-1;this.viewReady=false;this.lastPageIdx=0;this.createElement();var d=this;this.attachToContainer();if(this.enablescrollbuttons){this.prevButton=new b.PreviousButton(this.obj.id,this.settings,this.obj.id+"_prevButton",true);this.prevButton.obj.setAttribute("tabindex",-1);this.prevButton.obj.setAttribute("aria-hidden",true);b.Event.addDOMListener(this.prevButton,"click",function(h){d.processButtonClick(h,d.prevButton)})}this.swatchesLayout=new b.common.SwatchesLayout(this.obj,this.scrolltransition);this.swatchesLayout.setHorizontal(this.isHorizontal());this.swatchesLayout.setPartialSwatches(this.partialswatches);this.swatchesLayout.setPageMode(this.pagemode);this.swatchesLayout.setMaxLoadRadius(this.maxloadradius);this.swatchesLayout.onScrollCallback=function(h){d.updateScrollButtonsState();if(d.lastPageIdx!=d.swatchesLayout.getRestStateIdx()){d.lastPageIdx=d.swatchesLayout.getRestStateIdx();d.dispatchEvent(new b.event.SwatchEvent(b.event.SwatchEvent.SWATCH_PAGE_CHANGE,d.swatchesLayout.getRestStateIdx(),false))}};b.Util.css.setCSSAttributeSelector(this.obj,"scrollbar",this.scrollbar);if(this.enablescrollbuttons){this.nextButton=new b.NextButton(this.obj.id,this.settings,this.obj.id+"_nextButton",true);this.nextButton.obj.setAttribute("tabindex",-1);this.nextButton.obj.setAttribute("aria-hidden",true);b.Event.addDOMListener(this.nextButton,"click",function(h){d.processButtonClick(h,d.nextButton)})}this.setOrientationMarker();this.focusHandler=function(h){d.processFocus(h)};b.Event.addDOMListener(this.obj,"focus",this.focusHandler);this.keyDownHandler=function(h){d.processKeyDown(h)};b.Event.addDOMListener(this.obj,"keydown",this.keyDownHandler,{passive:false});if(!g){return new b.set.Swatches2Control(this)}else{return this}};b.Class.inherits("s7sdk.set.Swatches2","s7sdk.UIComponent");b.set.Swatches2.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},iscommand:{params:["value"],defaults:[""],parseParams:false},scrolltransition:{params:["value"],ranges:["0:"],defaults:[0.3]},autoscroll:{params:["enabled"],defaults:[false]},partialswatches:{params:["enabled"],defaults:[true]},scrollbar:{params:["enabled"],defaults:[false]},enablescrollbuttons:{params:["enabled"],defaults:[true]},maxloadradius:{params:["value"],defaults:[1],ranges:["-1:"]},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]},pagemode:{params:["enabled"],defaults:[true]}};b.set.Swatches2.RESTRICTED_STYLES={"s7swatches2":["width","height"]};b.set.Swatches2.prototype.setMediaSet=function(j){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches2.setMediaSet - mediaSet: %0",j);this.mediaSetDesc=j;for(var f=0;f<this.swatches.length;f++){this.swatches[f].dispose()}this.swatches=[];this.selectedSwatchIdx=-1;var d=this;var c=b.SwatchesParser.filterSet(j);for(var f=0;f<c.length;f++){var h=c[f];var g=new b.common.SwatchImageRenderer(this.serverUrl,this.iscommand,h.swatch,this.fmt,this.locale,h.type);g.onLoadCallback=function(){d.checkDispatchViewReady()};g.onClickCallback=function(i){d.onSwatchClicked(i,this)};if(f==0){g.setFocusable(true)}else{g.setFocusable(false)}this.swatches.push(g)}this.swatchesLayout.addRenderers(this.swatches);this.swatchesLayout.updateSize();this.swatchesLayout.startPreload();this.updateScrollButtonsState();this.swatchesLayout.updateSize();var e=new b.event.StatusEvent(b.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);b.Event.dispatch(this.obj,e,false)};b.set.Swatches2.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.set.Swatches.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.set.Swatches2.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (Swatches2) is unsupported! Please refer to SDK documentation on using setModifier.")};b.set.Swatches2.prototype.selectSwatch=function(c){if(this.selectedSwatchIdx!=-1){this.swatches[this.selectedSwatchIdx].setSelected(false)}this.selectedSwatchIdx=c;if(this.selectedSwatchIdx!=-1){this.swatches[this.selectedSwatchIdx].setSelected(true);for(var d=0;d<this.swatches.length;d++){this.swatches[d].setFocusable(false)}this.swatches[this.selectedSwatchIdx].setFocusable(true);var f=this.swatches[this.selectedSwatchIdx].item.owner;var e=new b.event.AssetEvent(b.event.AssetEvent.SWATCH_SELECTED_EVENT,f,this.selectedSwatchIdx,false);this.dispatchEvent(e);if(this.autoscroll&&!this.swatchesLayout.isItemVisible(c)){this.swatchesLayout.makeItemVisible(c)}}};b.set.Swatches2.prototype.getCurrentPage=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches2.getCurrentPage");return this.swatchesLayout.getRestStateIdx()};b.set.Swatches2.prototype.getPageCount=function(){return this.swatchesLayout.getRestStateCount()};b.set.Swatches2.prototype.setCurrentPage=function(c){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches.setCurrentPage - page: %0",c);this.swatchesLayout.setRestStateIdx(c)};b.set.Swatches2.prototype.resize=function(c,d){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches2.resize - width: %0, height: %1",c,d);this.width=c;this.height=d;this.obj.style.width=(this.width)+"px";this.obj.style.height=(this.height)+"px";this.setOrientationMarker();b.UIComponent.prototype.resize.apply(this,[c,d]);this.swatchesLayout.setHorizontal(this.isHorizontal());this.swatchesLayout.updateSize();if((this.selectedSwatchIdx!=-1)&&this.autoscroll&&!this.swatchesLayout.isItemVisible(this.selectedSwatchIdx)){this.swatchesLayout.makeItemVisible(this.selectedSwatchIdx)}this.updateScrollButtonsState()};b.set.Swatches2.prototype.getWidth=function(){return this.width};b.set.Swatches2.prototype.getHeight=function(){return this.height};b.set.Swatches2.prototype.addEventListener=function(e,d,c){b.Logger.log(b.Logger.FINE,"s7sdk.set.Swatches2.addEventListener - type: %0, handler: %1, useCapture: %2",e,d.toString().substring(0,d.toString().indexOf("(")),c);this.superproto.addEventListener.apply(this,[e,d,c])};b.set.Swatches2.prototype.dispose=function(){this.cleanUp();if(this.obj!=null&&this.obj.parentNode!=null){this.obj.parentNode.removeChild(this.obj)}};b.set.Swatches2.prototype.getLayout=function(){return this.swatchesLayout};b.set.Swatches2.prototype.isHorizontal=function(){return this.getWidth()>this.getHeight()};b.set.Swatches2.prototype.createElement=function(){b.UIComponent.prototype.createElement.apply(this,[]);this.obj.className="s7swatches2";this.obj.setAttribute("tabindex",0);this.obj.setAttribute("role","listbox")};b.set.Swatches2.prototype.onSwatchClicked=function(d,c){if(c!=this.swatches[this.selectedSwatchIdx]){this.dispatchEvent(new b.event.UserEvent(b.event.UserEvent.SWATCH,[c.item.frame,c.item.label?c.item.label:""],false))}this.selectSwatch(c.item.frame);this.obj.focus()};b.set.Swatches2.prototype.processButtonClick=function(d,c){if(c===this.prevButton){if(this.swatchesLayout.getRestStateIdx()>0){this.swatchesLayout.setRestStateIdx(this.swatchesLayout.getRestStateIdx()-1)}}if(c===this.nextButton){if(this.swatchesLayout.getRestStateIdx()<this.swatchesLayout.getRestStateCount()-1){this.swatchesLayout.setRestStateIdx(this.swatchesLayout.getRestStateIdx()+1)}}};b.set.Swatches2.prototype.getCurrentAsset=function(){return this.mediaSetDesc};b.set.Swatches2.prototype.setCurrentAsset=function(c){this.setMediaSet(c)};b.set.Swatches2.prototype.setOrientationMarker=function(){if(this.isHorizontal()){b.Util.css.setCSSAttributeSelector(this.obj,"orientation","horizontal")}else{b.Util.css.setCSSAttributeSelector(this.obj,"orientation","vertical")}};b.set.Swatches2.prototype.checkDispatchViewReady=function(){if(!this.viewReady&&this.swatchesLayout.isViewLoaded()){this.viewReady=true;var c=new b.event.StatusEvent(b.event.StatusEvent.NOTF_VIEW_READY,true);b.Event.dispatch(this.obj,c,false)}};b.set.Swatches2.prototype.updateScrollButtonsState=function(){if(!this.enablescrollbuttons){return}var c=(this.swatchesLayout.getRestStateCount()>1);b.Util.css.setCSSAttributeSelector(this.obj,"canscroll",c);if(this.swatchesLayout.getRestStateIdx()>0){this.prevButton.activate();this.prevButton.obj.setAttribute("tabindex",-1)}else{this.prevButton.deactivate()}if(this.swatchesLayout.getRestStateIdx()<this.swatchesLayout.getRestStateCount()-1){this.nextButton.activate();this.nextButton.obj.setAttribute("tabindex",-1)}else{this.nextButton.deactivate()}};b.set.Swatches2.prototype.processFocus=function(e){for(var d=0;d<this.swatches.length;d++){this.swatches[d].setFocusable(false)}this.focusedSwatchIdx=this.selectedSwatchIdx<0?0:this.selectedSwatchIdx;var c=this;this.swatchesLayout.executeAndRestoreScroll(function(){c.swatches[c.focusedSwatchIdx].focus()});this.swatches[this.focusedSwatchIdx].setFocusable(true);this.obj.setAttribute("tabindex",-1)};b.set.Swatches2.prototype.processKeyDown=function(e){var f=(e.which)?e.which:e.keyCode;var c=this;function d(j,h){if(h==c.focusedSwatchIdx){return}b.Event.preventDefault(j);c.focusedSwatchIdx=h;for(var g=0;g<c.swatches.length;g++){c.swatches[g].setFocusable(false)}c.swatches[c.focusedSwatchIdx].setFocusable(true);c.swatchesLayout.executeAndRestoreScroll(function(){c.swatches[c.focusedSwatchIdx].focus()});if(!c.swatchesLayout.isItemVisible(c.focusedSwatchIdx)){c.swatchesLayout.makeItemVisible(c.focusedSwatchIdx)}}switch(f){case b.Enum.KEY_CODE.RIGHT:if(this.isHorizontal()){d(e,Math.min(this.focusedSwatchIdx+1,this.swatches.length-1))}break;case b.Enum.KEY_CODE.LEFT:if(this.isHorizontal()){d(e,Math.max(this.focusedSwatchIdx-1,0))}break;case b.Enum.KEY_CODE.UP:if(!this.isHorizontal()){d(e,Math.max(this.focusedSwatchIdx-1,0))}break;case b.Enum.KEY_CODE.DOWN:if(!this.isHorizontal()){d(e,Math.min(this.focusedSwatchIdx+1,this.swatches.length-1))}break;case b.Enum.KEY_CODE.HOME:d(e,0);break;case b.Enum.KEY_CODE.END:d(e,this.swatches.length-1);break;case b.Enum.KEY_CODE.ENTER:case b.Enum.KEY_CODE.SPACE:b.Event.preventDefault(e);this.selectSwatch(this.focusedSwatchIdx);break}};b.set.Swatches2.prototype.cleanUp=function(){this.swatchesLayout.dispose();this.swatchesLayout=null;for(var c=0;c<this.swatches.length;c++){this.swatches[c].dispose()}this.swatches=[];b.Event.removeDOMListener(this.obj,"focus",this.focusHandler);b.Event.removeDOMListener(this.obj,"keydown",this.keyDownHandler,{passive:false});if(this.prevButton){this.prevButton.dispose()}if(this.nextButton){this.nextButton.dispose()}this.obj.style.cssText=""}}(function a(){var f=b.Util.css.createCssRuleText;var d=b.Util.css.createCssImgUrlText;var e={"background-size":"auto","width":"20px","height":"20px","flex-shrink":"0"};var c=f(".s7swatches2",{"background-color":"rgba(100, 100, 100, 0.2)","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","display":"flex","justify-content":"center","align-items":"center","width":"500px","height":"250px"})+f(".s7swatches2 .s7layoutbox",{"position":"relative","display":"flex","justify-content":"center","align-items":"center","overflow":"hidden","width":"100%","height":"100%","flex-grow":"1"})+f(".s7swatches2 .s7layout",{"position":"relative","display":"flex","flex-wrap":"nowrap","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box","justify-content":"start","align-items":"center","overflow":"auto"})+f(".s7swatches2 .s7thumbcell",{"text-align":"center","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box","margin":"5px","border":"1px solid transparent"})+f(".s7swatches2[scrollbar='false'] .s7layout::-webkit-scrollbar",{"display":"none"})+f(".s7swatches2[scrollbar='false'] .s7layout",{"-ms-overflow-style":"none","overflow":"-moz-scrollbars-none","scrollbar-width":"none"})+f(".s7swatches2[scrollbar='true'] .s7layout::-webkit-scrollbar",{"display":"auto"})+f(".s7swatches2[scrollbar='true'] .s7layout",{"-ms-overflow-style":"auto","overflow":"-moz-scrollbars-auto","scrollbar-width":"auto"})+f(".s7swatches2[canscroll='true'] .s7previousbutton",{"display":"block"})+f(".s7swatches2[canscroll='true'] .s7nextbutton",{"display":"block"})+f(".s7swatches2[canscroll='false'] .s7previousbutton",{"display":"none"})+f(".s7swatches2[canscroll='false'] .s7nextbutton",{"display":"none"})+f(".s7swatches2[orientation='horizontal'] .s7previousbutton",e)+f(".s7swatches2[orientation='horizontal'] .s7previousbutton[state='up']",{"background-image":d("scroll_left_up.png")})+f(".s7swatches2[orientation='horizontal'] .s7previousbutton[state='over']",{"background-image":d("scroll_left_over.png")})+f(".s7swatches2[orientation='horizontal'] .s7previousbutton[state='down']",{"background-image":d("scroll_left_down.png")})+f(".s7swatches2[orientation='horizontal'] .s7previousbutton[state='disabled']",{"background-image":d("scroll_left_disabled.png")})+f(".s7swatches2[orientation='horizontal'] .s7nextbutton",e)+f(".s7swatches2[orientation='horizontal'] .s7nextbutton[state='up']",{"background-image":d("scroll_right_up.png")})+f(".s7swatches2[orientation='horizontal'] .s7nextbutton[state='over']",{"background-image":d("scroll_right_over.png")})+f(".s7swatches2[orientation='horizontal'] .s7nextbutton[state='down']",{"background-image":d("scroll_right_down.png")})+f(".s7swatches2[orientation='horizontal'] .s7nextbutton[state='disabled']",{"background-image":d("scroll_right_disabled.png")})+f(".s7swatches2[orientation='vertical'] .s7previousbutton",e)+f(".s7swatches2[orientation='vertical'] .s7previousbutton[state='up']",{"background-image":d("scroll_up_up.png")})+f(".s7swatches2[orientation='vertical'] .s7previousbutton[state='over']",{"background-image":d("scroll_up_over.png")})+f(".s7swatches2[orientation='vertical'] .s7previousbutton[state='down']",{"background-image":d("scroll_up_down.png")})+f(".s7swatches2[orientation='vertical'] .s7previousbutton[state='disabled']",{"background-image":d("scroll_up_disabled.png")})+f(".s7swatches2[orientation='vertical'] .s7nextbutton",e)+f(".s7swatches2[orientation='vertical'] .s7nextbutton[state='up']",{"background-image":d("scroll_down_up.png")})+f(".s7swatches2[orientation='vertical'] .s7nextbutton[state='over']",{"background-image":d("scroll_down_over.png")})+f(".s7swatches2[orientation='vertical'] .s7nextbutton[state='down']",{"background-image":d("scroll_down_down.png")})+f(".s7swatches2[orientation='vertical'] .s7nextbutton[state='disabled']",{"background-image":d("scroll_down_disabled.png")})+f(".s7swatches2[orientation='vertical']",{"flex-direction":"column"})+f(".s7swatches2[orientation='horizontal']",{"flex-direction":"row"})+f(".s7swatches2[orientation='vertical'] .s7layout",{"flex-direction":"column"})+f(".s7swatches2[orientation='horizontal'] .s7layout",{"flex-direction":"row"})+f(".s7swatches2 .s7thumbcell[type='none']",{"border":"none !important","background-color":"transparent !important","pointer-events":"none !important"})+f(".s7swatches2 .s7thumb",{"display":"inline-block","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box","vertical-align":"top","width":"75px","height":"75px"})+f(".s7swatches2 .s7thumbcell[state='selected']",{"border":"1px solid #FFFFFF"})+f(".s7swatches2 .s7thumb .s7thumboverlay",{"width":"100%","height":"100%"})+f(".s7swatches2 .s7thumb .s7thumboverlay[type='swatchset']",{"background-image":d("asset_type_swatches.png")})+f(".s7swatches2 .s7thumb .s7thumboverlay[type='spinset']",{"background-image":d("asset_type_spin.png")})+f(".s7swatches2 .s7thumb .s7thumboverlay[type='video']",{"background-image":d("asset_type_video.png")})+f(".s7swatches2 .s7label",{"width":"75px","height":"10px","overflow":"hidden","text-overflow":"ellipsis","white-space":"nowrap","font-family":"Helvetica, sans-serif","font-size":"10px"});b.Util.css.addDefaultCSS(c,"Swatches2")})()})(s7getCurrentNameSpace());