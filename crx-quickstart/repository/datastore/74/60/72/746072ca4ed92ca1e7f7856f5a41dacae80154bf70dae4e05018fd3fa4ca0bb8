/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.image");b.Util.require("s7sdk.common.Thumb");b.Util.require("s7sdk.common.Geometry");if(!b.image.ImageMapEffectControl){b.image.ImageMapEffectControl=function(e){arguments.callee.superclass.apply(this,[e,b.image.ImageMapEffectControl.NS,e.constructor,b.image.ImageMapEffect.RESTRICTED_STYLES])};b.image.ImageMapEffectControl.NS="s7sdk.image.ImageMapEffectControl";b.image.ImageMapEffectControl.prototype.rebuild=function(h){var e=this.component.itemIndex_;var g=this.component.mediaSet_;var f=this.getOverlaysVisible();this.superproto.rebuild.apply(this,[h]);this.component.mediaSet_=g;if(g.items&&g.items[e]){if(!g.items[e].mapsuppressed){this.component.setCurrentIndex(e)}else{this.component.retrieveImageMap(g.items[e])}}this.setOverlaysVisible(f)}}b.Class.inherits(b.image.ImageMapEffectControl.NS,"s7sdk.ControlComponent");if(!b.image.ImageMapEffect){b.image.ImageMapEffect=function ImageMapEffect(f,h,g){this.fadeTimer=null;var i=!!arguments[3];b.Logger.log(b.Logger.CONFIG,"s7sdk.image.ImageMapEffect constructor - containerId: %0, settings: %1 , compId: %2",f,h,g);g=(typeof g=="string"&&g.length)?g:"ImageMapEffect_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[g,f,"div","s7imagemapeffect",h,!i]);this.serverUrl=b.Util.normalizeUrl(this.serverUrl);this.container=this.getParent();var j=this.container?this.container.s7base:null;if(this.mode=="auto"){this.mode=b.browser.supportsTouch()?"icon":"region"}if(b.browser.supportsTouch()){this.rollover=false}var e=0;e|=this.mode=="region"?b.image.ImageMapEffect.OVERLAY_FLAG:0;e|=this.mode=="icon"?b.image.ImageMapEffect.ICON_FLAG:0;e|=this.mode=="mixed"?b.image.ImageMapEffect.MIXED_FLAG:0;e|=b.browser.supportsTouch()?b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG:0;e|=this.mapTips==true?b.image.ImageMapEffect.TOOLTIP_FLAG:0;this.create(j,this.serverUrl,e,this.rollover==true);if(!this.hint){this.hint=document.createElement("span");this.hint.id=this.id+"_hint";this.hint.style.display="none";this.hint.innerText=this.getLocalizedText("USAGE_HINT");this.obj.appendChild(this.hint)}this.enableJavaScript=true;if(!i){return new b.image.ImageMapEffectControl(this)}else{return this}};b.Class.inherits("s7sdk.image.ImageMapEffect","s7sdk.UIComponent");b.image.ImageMapEffect.RESTRICTED_STYLES={"s7imagemapeffect s7icon":["width","height"],"s7imagemapeffect s7region":["background","background-color","border-left","border-right","border-top","border-bottom","border-width","border-color","border"],};b.image.ImageMapEffect.prototype.setCSS=function(g,f,e){if(this.isRestrictedCSSProperty(b.image.ImageMapEffect.RESTRICTED_STYLES,f)){throw new Error("You cannot set "+g+" : "+f+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[g,f,e])}};b.image.ImageMapEffect.prototype.setModifier=function(e){throw new Error("Trying to use setModifier on the Core class (ImageMapEffect) is unsupported! Please refer to SDK documentation on using setModifier.")};b.image.ImageMapEffect.prototype.enableJavaScriptHrefs=function(e){this.enableJavaScript=e};b.image.ImageMapEffect.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.image.ImageMapEffect.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},rollover:{params:["rollover"],defaults:[true]},mapTips:{params:["maptips"],defaults:[false]},mode:{params:["value"],defaults:["icon"],ranges:[["region","icon","auto","none","mixed"]]}};b.image.ImageMapEffect.ICON_FLAG=1;b.image.ImageMapEffect.OVERLAY_FLAG=2;b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG=4;b.image.ImageMapEffect.TOOLTIP_FLAG=8;b.image.ImageMapEffect.MIXED_FLAG=16;b.image.ImageMapEffect.prototype.symbols={USAGE_HINT:"Use arrow keys to navigate between individual hot spots, Enter or space key to activate it and Tab or Shift-Tab to go to another UI element.",TYPE_LINK:"Link",TYPE_QUICK_VIEW:"Quick View",TYPE_VIDEO:"Video",TYPE_TARGET:"Target",TYPE_ROLL_OVER:"Roll over information",TYPE_ACTION:"Action"};b.image.ImageMapEffect.prototype.create=function(j,e,f,i,h){this.flags_=f;this.target_=null;this.linkedOverlayMap_=null;this.serverUrl_=e;this.itemIndex_=-1;this.mapOverlays_=null;this.overlayContainer_=null;this.destroyed_=false;this.overlaysVisible_=true;this.overlaysActive=true;this.lastFocusIdx=0;this.mediaSet_=null;this.rollover_=i;this.createElement();this.obj.style.position="absolute";this.obj.style.top="0px";this.obj.style.left="0px";var g=this;this.__targetZoomRegion=function(k){g.targetZoomRegion(k)};this.__targetAssetChanged=function(k){g.targetAssetChanged(k)};this.__targetItemSelected=function(k){g.targetAssetChanged(k)};this.__transitionStart=function(k){g.transitionStart(k)};this.__transitionEnd=function(k){g.transitionEnd(k)};this.__tgtMouseDownHandler=function(k){g.tgtMouseMapHandler(k,0)};this.__tgtMouseMoveHandler=function(k){g.tgtMouseMapHandler(k,1)};this.__tgtMouseUpHandler=function(k){g.tgtMouseMapHandler(k,2)};if(j!=null){this.attachToView(j)}};b.image.ImageMapEffect.prototype.addEventListener=function(g,f,e){b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.addEventListener - type: %0, handler: %1, useCapture: %2",g,f.toString().substring(0,f.toString().indexOf("(")),e);b.Base.prototype.addEventListener.apply(this,[g,f,e])};b.image.ImageMapEffect.prototype.attachToView=function(e){if(e!==this.target_){if(this.target_){this.detachFromView(this.target_)}this.target_=e;if(e){if((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0){if(window.PointerEvent&&b.browser.name==="ie"){b.Event.addDOMListener(this.target_,"pointerdown",this.__tgtMouseDownHandler,{passive:false,capture:true});b.Event.addDOMListener(this.target_,"pointerup",this.__tgtMouseUpHandler,{passive:false,capture:true});b.Event.addDOMListener(this.target_,"pointermove",this.__tgtMouseMoveHandler,{passive:false,capture:true})}else{b.Event.addDOMListener(this.target_,"mousedown",this.__tgtMouseDownHandler,{passive:false,capture:true});b.Event.addDOMListener(this.target_,"mouseup",this.__tgtMouseUpHandler,{passive:false,capture:true});b.Event.addDOMListener(this.target_,"mousemove",this.__tgtMouseMoveHandler,{passive:false,capture:true})}b.Event.addDOMListener(this.target_,"touchstart",this.__tgtMouseDownHandler,{passive:false,capture:true});b.Event.addDOMListener(this.target_,"touchend",this.__tgtMouseUpHandler,{passive:false,capture:true});b.Event.addDOMListener(this.target_,"touchmove",this.__tgtMouseMoveHandler,{passive:false,capture:true})}this.target_.addEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion);this.target_.addEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged);this.target_.addEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected);this.target_.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart);this.target_.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd);this.target_.obj.appendChild(this.obj)}}};b.image.ImageMapEffect.prototype.fixEvent=function(g){var f=null;if(g.target){f=(g.target.nodeType==3)?g.target.parentNode:g.target}else{f=g.srcElement}g.targetNode=f;if(!g.touches){g.touches=[{pageX:g.pageX||g.clientX+(document&&document.scrollLeft||document.body&&document.body.scrollLeft||0)-(document&&document.clientLeft||document.body&&document.body.clientLeft||0),pageY:g.pageY||g.clientY+(document&&document.scrollTop||document.body&&document.body.scrollTop||0)-(document&&document.clientTop||document.body&&document.body.clientTop||0)}]}if(!g.preventDefault){g.preventDefault=function(){g.returnValue=false}}if(!g.stopPropagation){g.stopPropagation=function(){g.cancelBubble=true}}return g};b.image.ImageMapEffect.prototype.tgtMouseMapHandler=function(v,z){if(this.mapOverlays_&&this.mapOverlays_.length&&this.overlaysVisible_){this.fixEvent(v);var m,l;switch(z){case 2:if(!this.touch||!this.touch.start){return}m=this.touch.start.x;l=this.touch.start.y;break;case 1:this.touch={isMove:false};default:if(v.touches.length!=1){return}m=v.touches[0].pageX;l=v.touches[0].pageY}var g=m;var j=l;if(this.overlayContainer_.displayElement){var h=b.Util.getObjPos(this.overlayContainer_.displayElement);g=m-h.x;j=l-h.y}var r=this.reverseTransformPoint(new b.Point2D(g,j));var q=-1;var f=-1;var u;for(var s=0;s<this.mapOverlays_.length;s++){u=this.mapOverlays_[s];if(u.isOver){f=s;if(b.browser.device.name=="desktop"&&u.toolTip_){u.toolTip_.mouseMoveHandler(v)}}if(u.checkMousePoint(r.x,r.y)&&q==-1){q=s;u.isOver=true}else{u.isOver=false}}if(q!=f&&b.browser.device.name=="desktop"){var o=this.overlayContainer_.displayElement.getContext("2d");o.save();o.clearRect(0,0,this.overlayContainer_.getWidth(),this.overlayContainer_.getHeight());o.restore();if(this.lastShowing!=-1){u=this.mapOverlays_[this.lastShowing];var k=u.getBounds();if(this.rollover==true){var n=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_DEACTIVATED,u.mapDesc_.rolloverKey,k);this.overlayRolloverEvent(n)}this.lastShowing=-1;if(b.browser.device.name=="desktop"&&u.toolTip_){u.toolTip_.rollOutHandler(v)}}if(q!=-1){u=this.mapOverlays_[q];u.showShape();var p=this.getLinkedOverlays(u);for(var s=0;s<p.length;s++){var w=p[s];if(w!=u){var t=w.isOver;w.isOver=true;if(w.shape){w.showShape()}w.isOver=t}}var k=u.getBounds();if(this.rollover==true){var n=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_ACTIVATED,u.mapDesc_.rolloverKey,k);this.overlayRolloverEvent(n)}if(b.browser.device.name=="desktop"&&u.toolTip_){u.toolTip_.rollOverHandler(v)}this.lastShowing=q}}for(var s=0;s<this.mapOverlays_.length;s++){u=this.mapOverlays_[s];if(u.isOver){switch(z){case 0:this.touch={start:{x:m,y:l}};this.touch.isMove=false;break;case 1:if(!this.touch){this.touch={}}this.touch.isMove=true;break;case 2:if(!this.touch.isMove&&!this.isIconActivated){u.overlayClickHandler_(v);b.Event.preventDefault(v);b.Event.stopPropagation(v)}this.touch=null;break}break}}}};b.image.ImageMapEffect.prototype.targetZoomRegion=function(e){this.updateOverlayCoverage()};b.image.ImageMapEffect.prototype.targetAssetChanged=function(f){var e=f.s7event.asset instanceof b.MediaSetDesc?f.s7event.asset.items[f.s7event.frame]:f.s7event.asset;if(typeof e=="string"){throw new Error("AssetEvent should not be providing a string as the asset, it should be an ItemDesc!")}if(e.parent==null){throw new Error("ItemDesc must be part of a parent set!")}this.mediaSet_=e.parent;if(this.mediaSet_.items&&this.mediaSet_.items[f.s7event.frame]){if(!this.mediaSet_.items[f.s7event.frame].mapsuppressed){this.setCurrentIndex(f.s7event.frame)}else{this.retrieveImageMap(this.mediaSet_.items[f.s7event.frame])}}};b.image.ImageMapEffect.prototype.transitionStart=function(e){if(this.overlayContainer_){this.overlayContainer_.style.visibility="hidden"}};b.image.ImageMapEffect.prototype.transitionEnd=function(e){if(this.overlayContainer_){this.overlayContainer_.style.visibility="inherit"}};b.image.ImageMapEffect.prototype.retrieveImageMap=function(e){if(this.serverUrl_==null||!(e instanceof b.ImageDesc)){b.Logger.log(b.Logger.WARNING,"ImageMapEffectCC.retrieveImageMap Neither serverUrl or image can be null!");return}this.removeOverlaysFromView(true);this.stopRequest();b.Logger.log(b.Logger.INFO,"ImageMapEffectCC.retrieveImageMap Performing map request for image: %0",e.name);var f=b.Util.resolveURL(this.serverUrl_,e.name);if(f.indexOf("?")==-1){f+="?req=map"}else{f+="&req=map"}f+=",json,utf-8&scl=1";this.isReq_=new b.IS();this.isReq_.getHttpReq(f,function(h,g){b.ImageMapEffect.prototype.loadCompleteHandler.apply(g,[h])},null,this)};b.image.ImageMapEffect.prototype.loadCompleteHandler=function(f){if(this.destroyed_){return}var e=b.ImageMapUtil.parseMapAreaArray(f);if(this.mediaSet_){var g=[];if(this.mediaSet_.maps){g=g.concat(this.mediaSet_.maps)}if(typeof e!="undefined"&&e instanceof Array){g=g.concat(e)}this.createMapOverlays(g)}else{throw new Error("Internal media-set unknown!")}};b.image.ImageMapEffect.prototype.stopRequest=function(){if(this.isReq_){this.isReq_.cancelHttpReq()}};b.image.ImageMapEffect.prototype.setCurrentIndex=function(e){this.itemIndex_=e;this.stopRequest();if(this.mediaSet_){var g=[];if(this.mediaSet_.maps){g=g.concat(this.mediaSet_.maps)}if(this.mediaSet_.items&&this.mediaSet_.items[e]){var f=this.mediaSet_.items[e];if(typeof f.maps!="undefined"&&f.maps instanceof Array){g=g.concat(f.maps)}}this.createMapOverlays(g)}else{throw new Error("Internal media-set unknown!")}};b.image.ImageMapEffect.prototype.getOverlaysVisible=function(){b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.getOverlaysVisible");return this.overlaysVisible_};b.image.ImageMapEffect.prototype.setOverlaysVisible=function(e){b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.setOverlaysVisible - value: %0",e);this.overlaysVisible_=e;if(e){this.updateOverlayCoverage(true)}else{this.removeOverlaysFromView(false)}};b.image.ImageMapEffect.prototype.updateOverlayCoverage=function(f){f=(typeof f=="undefined")?false:f;if(this.target_&&this.mapOverlays_&&this.mapOverlays_.length&&this.overlaysVisible_){if(!this.overlayContainer_){this.overlayContainer_=this.createOverlayContainer(0,0,0,0);var e=this;this.focusHandler=function(o){if(!e.overlaysActive){return}b.Event.preventDefault(o);if(e.overlayContainer_.getAttribute("tabindex")==0){for(var n=0;n<e.mapOverlays_.length;n++){var m=e.mapOverlays_[n].element_.getAttribute("tabindex");if(m==0){e.mapOverlays_[n].element_.focus();break}}e.overlayContainer_.setAttribute("tabindex",-1)}};this.keyHandler=function(o){if(!e.overlaysActive){return}var p=(o.which)?o.which:o.keyCode;if(p==b.Enum.KEY_CODE.TAB){e.overlayContainer_.scrollTop=0;e.overlayContainer_.scrollLeft=0;return}switch(p){case b.Enum.KEY_CODE.RIGHT:case b.Enum.KEY_CODE.DOWN:b.Event.preventDefault(o);b.Event.stopPropagation(o);for(var n=0;n<e.mapOverlays_.length;n++){if(e.mapOverlays_[n].inFocus==true){var m=e.findNeighbor(e.mapOverlays_[n],true);e.mapOverlays_[n].inFocus=false;m.element_.focus();break}}break;case b.Enum.KEY_CODE.LEFT:case b.Enum.KEY_CODE.UP:b.Event.preventDefault(o);b.Event.stopPropagation(o);for(var n=0;n<e.mapOverlays_.length;n++){if(e.mapOverlays_[n].inFocus==true){var m=e.findNeighbor(e.mapOverlays_[n],false);e.mapOverlays_[n].inFocus=false;m.element_.focus();break}}break}if((p==b.Enum.KEY_CODE.ENTER)||(p==b.Enum.KEY_CODE.SPACE)){b.Event.preventDefault(o);for(var n=0;n<e.mapOverlays_.length;n++){if(e.mapOverlays_[n].inFocus==true){e.mapOverlays_[n].__overlayClickHandler(o);break}}}};b.Event.addDOMListener(this.overlayContainer_,"focus",this.focusHandler,{capture:true});b.Event.addDOMListener(this.overlayContainer_,"keydown",this.keyHandler,{passive:false})}this.overlayContainer_.setWidth(this.target_.wid);this.overlayContainer_.setHeight(this.target_.hei);if(!this.overlayContainer_.parentNode){this.obj.appendChild(this.overlayContainer_)}for(var j=0;j<this.mapOverlays_.length;j++){var h=this.mapOverlays_[j];h.updateOverlay();if(!h.element_.parentNode||h.element_.parentNode.nodeType!=1){this.overlayContainer_.appendChild(h.element_)}}var l=[];function k(m,i){return m.element_.getY()-i.element_.getY()||m.element_.getX()-i.element_.getX()}for(var j=0;j<this.mapOverlays_.length;j++){this.mapOverlays_[j].element_.setAttribute("tabindex",-1)}for(var j=0;j<this.mapOverlays_.length;j++){var g=this.mapOverlays_[j];if(g.element_.getAttribute("focusable")=="true"){l.push(g)}}l.sort(k);if(l[0]&&this.overlaysActive){l[0].element_.setAttribute("tabindex",0)}if(f){this.fadeInOverlays_()}}};b.image.ImageMapEffect.prototype.fadeInOverlays_=function(){var h=this.overlayContainer_;var e=parseFloat(b.Util.css.getCss("s7mapoverlay s7icon","opacity",null,"s7imagemapeffect",this.overlayContainer_,{state:"default"}));var f=this;function g(){if(!h.currentOpacity_){h.currentOpacity_=0}if(h.currentOpacity_<e){h.currentOpacity_+=0.05/0.5;for(var j=0;j<h.childNodes.length;j++){b.Util.setOpacity(h.childNodes[j],h.currentOpacity_)}f.fadeTimer=setTimeout(g,50)}else{if(b.browser.device.name=="desktop"){for(var j=0;j<h.childNodes.length;j++){h.childNodes[j].style.opacity=""}}}if(b.browser.device.name=="android"&&b.browser.device.version=="4"){h.style.display="none";var k=h.offsetWidth;h.style.display="block"}}g()};b.image.ImageMapEffect.prototype.removeOverlaysFromView=function(g){g=(typeof g=="undefined")?false:g;if(this.overlayContainer_&&this.overlayContainer_.parentNode){this.overlayContainer_.parentNode.removeChild(this.overlayContainer_)}if(g){this.overlayContainer_=null;if(this.mapOverlays_){for(var f=0;f<this.mapOverlays_.length;f++){var e=this.mapOverlays_[f];e.cleanUp()}this.mapOverlays_=null}}};b.image.ImageMapEffect.prototype.detachFromView=function(e){if((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0){if(window.PointerEvent&&b.browser.name==="ie"){b.Event.removeDOMListener(e,"pointerdown",this.__tgtMouseDownHandler,{passive:false,capture:true});b.Event.removeDOMListener(e,"pointerup",this.__tgtMouseUpHandler,{passive:false,capture:true});b.Event.removeDOMListener(e,"pointermove",this.__tgtMouseMoveHandler,{passive:false,capture:true})}else{b.Event.removeDOMListener(e,"mousedown",this.__tgtMouseDownHandler,{passive:false,capture:true});b.Event.removeDOMListener(e,"mouseup",this.__tgtMouseUpHandler,{passive:false,capture:true});b.Event.removeDOMListener(e,"mousemove",this.__tgtMouseMoveHandler,{passive:false,capture:true})}b.Event.removeDOMListener(e,"touchstart",this.__tgtMouseDownHandler,{passive:false,capture:true});b.Event.removeDOMListener(e,"touchend",this.__tgtMouseUpHandler,{passive:false,capture:true});b.Event.removeDOMListener(e,"touchmove",this.__tgtMouseMoveHandler,{passive:false,capture:true})}e.removeEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion);e.removeEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged);e.removeEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected);e.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart);e.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd);if(this.obj.parentElement===e.obj){this.obj.parentElement.removeChild(this.obj)}};b.image.ImageMapEffect.prototype.cleanUp=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}if(this.fadeTimer){clearTimeout(this.fadeTimer);this.fadeTimer=null}if(this.target_){this.detachFromView(this.target_);this.target_=null}this.container=null;b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.cleanUp");this.removeOverlaysFromView(true);this.destroyed_=true;if(this.obj){b.Util.removeTags(this.obj);this.obj.style.cssText=""}};b.image.ImageMapEffect.prototype.createMapOverlays=function(f){this.removeOverlaysFromView(true);this.mapOverlays_=[];this.linkedOverlayMap_={};this.lastShowing=-1;for(var i=0;i<f.length;i++){var e=f[i];var h=new b.MapAreaOverlay(this,e,this.flags_,this.rollover_);this.mapOverlays_.push(h);var g;if(e.rolloverKey&&e.rolloverKey.length){g=e.rolloverKey}else{if(e.href&&e.href.length){g=e.href}}if(g){var k=this.linkedOverlayMap_[g];if(!k){k=[];this.linkedOverlayMap_[g]=k}k.push(h)}}function j(m,l){return(m.getArea()==l.getArea())?0:((m.getArea()>l.getArea())?1:-1)}this.mapOverlays_.sort(j);if(this.overlaysVisible_){this.updateOverlayCoverage(true)}};b.image.ImageMapEffect.prototype.createOverlayContainer=function(f,i,g,e){var h=b.image.ImageMapEffect.createSmartDiv(false,((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0));h.setX(f);h.setY(i);h.setWidth(g);h.setHeight(e);h.style.overflow="hidden";h.style.position="absolute";h.style.pointerEvents="none";h.id=this.id+"_overlayContainer";return h};b.image.ImageMapEffect.createSmartDiv=function(f,e){var g=(f&&typeof f!="undefined")?f:document.createElement("div");if(e&&!g.displayElement){g.displayElement=document.createElement("canvas");g.appendChild(g.displayElement)}g.setAttribute("tabindex",0);g.getX=function(){return g.x_||parseInt(g.style.left)};g.getY=function(){return g.y_||parseInt(g.style.top)};g.getWidth=function(){return g.width_||parseInt(g.style.width)};g.getHeight=function(){return g.height_||parseInt(g.style.height)};g.setX=function(h){g.x_=h;g.style.left=h+"px"};g.setY=function(h){g.y_=h;g.style.top=h+"px"};g.setWidth=function(h){g.width_=h;if(!g.displayElement){g.style.width=h+"px";return}g.displayElement.setAttribute("width",h);g.displayElement.style.width=g.style.width=h+"px"};g.setHeight=function(h){g.height_=h;if(!g.displayElement){g.style.height=h+"px";return}g.displayElement.setAttribute("height",h);g.displayElement.style.height=g.style.height=h+"px"};return g};b.image.ImageMapEffect.prototype.getLinkedOverlays=function(g){var h;if(this.linkedOverlayMap_){var f;var e=g.getMapDesc();if(e.rolloverKey&&e.rolloverKey.length){f=e.rolloverKey}else{if(e.href&&e.href.length){f=e.href}}h=this.linkedOverlayMap_[f]}if(!h){h=[]}return h};b.image.ImageMapEffect.prototype.transformPoint=function(e){return this.target_.imagePixelsToViewPoint(e)};b.image.ImageMapEffect.prototype.reverseTransformPoint=function(e){return this.target_.viewPointToImagePixels(e)};b.image.ImageMapEffect.prototype.getTargetId=function(){return this.target_.obj.id};b.image.ImageMapEffect.prototype.getTargetClassName=function(){return this.target_.obj.className};b.image.ImageMapEffect.prototype.overlayRolloverEvent=function(e){this.dispatchEvent(e)};b.image.ImageMapEffect.prototype.getModifiers=function(){return this.modifiers};b.image.ImageMapEffect.prototype.findNeighbor=function(h,l){var f=null;var m=h;var g=[];function e(o,i){return o.element_.getY()-i.element_.getY()||o.element_.getX()-i.element_.getX()}for(var k=0;k<this.mapOverlays_.length;k++){var j=this.mapOverlays_[k];if(j.element_.getAttribute("focusable")=="true"){g.push(j)}}g.sort(e);var n=g.indexOf(h);if(n!=-1&&l){if(n<g.length-1){m=g[n+1]}else{m=g[0]}}else{if(n!=-1&&!l){if(n>0){m=g[n-1]}else{m=g[g.length-1]}}}return m};b.image.ImageMapEffect.prototype.activate=function(){if(this.mapOverlays_&&this.mapOverlays_[this.lastFocusIdx]){this.mapOverlays_[this.lastFocusIdx].element_.setAttribute("tabindex",0)}for(var e=0;e<this.mapOverlays_.length;e++){this.mapOverlays_[e].element_.style.pointerEvents="auto";b.Event.addDOMListener(this.mapOverlays_[e].element_,"focus",this.mapOverlays_[e].focusHandler);b.Event.addDOMListener(this.mapOverlays_[e].element_,"blur",this.mapOverlays_[e].blurHandler)}if(this.overlayContainer_){this.overlayContainer_.setAttribute("tabindex",0)}this.setCSS(".s7imagemapeffect","pointer-events","auto");this.overlaysActive=true;this.activated=true};b.image.ImageMapEffect.prototype.deactivate=function(){for(var e=0;e<this.mapOverlays_.length;e++){this.lastFocusIdx=(this.mapOverlays_[e].element_.getAttribute("tabindex")==0)?e:0;this.mapOverlays_[e].element_.setAttribute("tabindex",-1);this.mapOverlays_[e].element_.style.pointerEvents="none";b.Event.removeDOMListener(this.mapOverlays_[e].element_,"focus",this.mapOverlays_[e].focusHandler);b.Event.removeDOMListener(this.mapOverlays_[e].element_,"blur",this.mapOverlays_[e].blurHandler)}if(this.overlayContainer_){this.overlayContainer_.setAttribute("tabindex",-1)}this.setCSS(".s7imagemapeffect","pointer-events","none");this.overlaysActive=false;this.activated=false};(function a(){var h=b.Util.css.createCssRuleText;var g=b.Util.css.createCssImgUrlText;var f=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var e=h(".s7imagemapeffect .s7icon",{"width":"50px","height":"50px","background-repeat":"no-repeat","background-position":"center","background-image":g("map_overlay_icon.png"),"z-index":"999","cursor":"pointer","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","touch-action":f?"none":""})+h(".s7imagemapeffect .s7icon[state='default']",{"opacity":"0.6"})+h(".s7imagemapeffect .s7icon[state='active']",{"opacity":"1"})+h(".s7imagemapeffect .s7region",{"background":"rgba(0,0,0, 0)","border":"1px solid #000000"});b.Util.css.addDefaultCSS(e,"ImageMapEffect")})()}if(!b.MapAreaOverlay){b.MapAreaOverlay=function c(j,f,g,i){this.overlayManager_=j;this.mapDesc_=f;this.flags_=g;this.iconStyle_="s7mapareaicon";this.rollover_=i;this.active_=false;this.rawShapeInfo_=null;this.targetClassName_=this.overlayManager_.cl;this.targetId_=this.overlayManager_.id;this.element_=this.createDiv();if(this.mapDesc_.shape==b.MapDescShape.SHAPE_POLY){var h=this.getPoints(this.mapDesc_.coords,false);this.rawShapeInfo_=this.processPolygon(h);if((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||((this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0&&!this.isIcon())){this.createShape(h)}}var e=this;this.__overlayRolloverHandler=function(k){e.overlayRolloverHandler_(k)};this.__overlayClickHandler=function(k){e.overlayClickHandler_(k)};this.__touchHandler=function(k){e.touchHandler_(k)};this.__overlayMouseDownHandler=function(k){e.overlayMouseDownHandler_(k)};if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||((this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0&&this.isIcon())){if(window.PointerEvent&&b.browser.name==="ie"){b.Event.addDOMListener(this.element_,"pointerover",this.__overlayRolloverHandler);if(this.rollover_){b.Event.addDOMListener(this.element_,"pointerout",this.__overlayRolloverHandler)}b.Event.addDOMListener(this.element_,"pointerdown",this.__overlayMouseDownHandler,{capture:true});b.Event.addDOMListener(this.element_,"click",this.__overlayClickHandler,{passive:false})}else{b.Event.addDOMListener(this.element_,"mouseover",this.__overlayRolloverHandler,{passive:false});if(this.rollover_){b.Event.addDOMListener(this.element_,"mouseout",this.__overlayRolloverHandler,{passive:false})}b.Event.addDOMListener(this.element_,"mousedown",this.__overlayMouseDownHandler,{passive:false});b.Event.addDOMListener(this.element_,"click",this.__overlayClickHandler,{passive:false})}b.Event.addDOMListener(this.element_,"touchstart",this.__touchHandler,{passive:false});b.Event.addDOMListener(this.element_,"touchmove",this.__touchHandler,{passive:false});b.Event.addDOMListener(this.element_,"touchend",this.__touchHandler,{passive:false})}this.focusHandler=function(m){b.Event.preventDefault(m);e.inFocus=true;for(var l=0;l<e.overlayManager_.mapOverlays_.length;l++){e.overlayManager_.mapOverlays_[l].element_.setAttribute("tabindex",-1)}e.element_.setAttribute("tabindex",0);e.overlayManager_.overlayContainer_.scrollTop=0;e.overlayManager_.overlayContainer_.scrollLeft=0;if((e.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||((e.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0&&!e.isIcon())){e.isOver=true;e.showShape()}e.element_.setAttribute("aria-describedby",e.overlayManager_.hint.id);var k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.FOCUSED,e.mapDesc_.rolloverKey,e.getBounds());e.overlayManager_.overlayRolloverEvent(k)};b.Event.addDOMListener(this.element_,"focus",this.focusHandler);this.blurHandler=function(l){b.Event.preventDefault(l);e.inFocus=false;if((e.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||((e.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0&&!e.isIcon())){e.isOver=false;var m=e.overlayManager_.overlayContainer_.displayElement.getContext("2d");m.save();m.clearRect(0,0,e.overlayManager_.overlayContainer_.getWidth(),e.overlayManager_.overlayContainer_.getHeight());m.restore()}e.element_.removeAttribute("aria-describedby");var k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.BLURRED,e.mapDesc_.rolloverKey,e.getBounds());e.overlayManager_.overlayRolloverEvent(k)};b.Event.addDOMListener(this.element_,"blur",this.blurHandler);if((this.flags_&b.image.ImageMapEffect.TOOLTIP_FLAG)&&this.mapDesc_.alt&&this.mapDesc_.alt.length){this.toolTip_=new b.SimpleToolTip(this.element_,this.mapDesc_.alt)}if(this.flags_&b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG){this.setActive(true)}};b.MapAreaOverlay.prototype.overlayMouseDownHandler_=function(e){if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0){this.overlayManager_.isIconActivated=true;b.image.ImageMapEffect.prototype.fixEvent(e);b.Event.preventDefault(e);b.Event.stopPropagation(e)}};b.MapAreaOverlay.prototype.touchHandler_=function(e){if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0){if(e.type=="touchstart"){this.overlayManager_.isIconActivated=true}if(e.type=="touchend"){this.overlayClickHandler_(e);return}b.image.ImageMapEffect.prototype.fixEvent(e);b.Event.preventDefault(e);b.Event.stopPropagation(e)}if(e.type=="touchmove"){b.Event.preventDefault(e)}};b.MapAreaOverlay.prototype.getActive=function(){return this.active_};b.MapAreaOverlay.prototype.setActive=function(e){if(this.active_!=e){this.active_=e;this.updateOverlay()}};b.MapAreaOverlay.prototype.getArea=function(){return this.rawShapeInfo_?this.rawShapeInfo_.area:NaN};b.MapAreaOverlay.prototype.getMapDesc=function(){return this.mapDesc_};b.MapAreaOverlay.prototype.cleanUp=function(){if(this.rollover_){if(window.PointerEvent&&b.browser.name==="ie"){b.Event.removeDOMListener(this.element_,"pointerover",this.__overlayRolloverHandler);b.Event.removeDOMListener(this.element_,"pointerout",this.__overlayRolloverHandler)}else{b.Event.removeDOMListener(this.element_,"mouseover",this.__overlayRolloverHandler,{passive:false});b.Event.removeDOMListener(this.element_,"mouseout",this.__overlayRolloverHandler,{passive:false})}}if(this.toolTip_){this.toolTip_.removeToolTip()}b.Event.removeDOMListener(this.element_,"touchstart",this.__touchHandler,{passive:false});b.Event.removeDOMListener(this.element_,"touchmove",this.__touchHandler,{passive:false});b.Event.removeDOMListener(this.element_,"touchend",this.__touchHandler,{passive:false})};b.MapAreaOverlay.prototype.updateOverlay=function(){if(this.mapDesc_.shape==b.MapDescShape.SHAPE_POLY){if(this.shape){if(this.overlayManager_.overlayContainer_&&this.overlayManager_.overlayContainer_.displayElement){this.showShape()}}var f=this.getPoints(this.mapDesc_.coords,true);var e=this.processPolygon(f).centroid;this.element_.setX(e.x-this.element_.getWidth()/2);this.element_.setY(e.y-this.element_.getHeight()/2);b.Util.css.setCSSAttributeSelector(this.element_,"state",this.active_?"active":"default");if((this.element_.offsetLeft+this.element_.offsetWidth)<0||(this.element_.offsetTop+this.element_.offsetHeight)<0||this.overlayManager_.overlayContainer_&&(this.element_.offsetLeft>this.overlayManager_.overlayContainer_.offsetWidth)||this.overlayManager_.overlayContainer_&&(this.element_.offsetTop>this.overlayManager_.overlayContainer_.offsetHeight)){this.element_.setAttribute("focusable","false");this.element_.setAttribute("tabindex",-1)}else{this.element_.setAttribute("focusable","true");if(this.overlayManager_.overlaysActive){this.element_.setAttribute("tabindex",0)}}}};b.MapAreaOverlay.prototype.showShape=function(){var k=this.overlayManager_.overlayContainer_.displayElement.getContext("2d");var j=k.globalCompositeOperation;if(this.isOver||((this.flags_&b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG)!=0)){k.save();k.beginPath();k.save();k.translate(0,0);var e=this.getTransformedPoint(0);k.moveTo(e.x,e.y);for(var h=0;h<this.shape.points.length;h++){e=this.getTransformedPoint(h);k.lineTo(e.x,e.y)}k.closePath();k.restore();k.globalCompositeOperation="destination-out";k.fill();k.globalCompositeOperation=j;k.fillStyle=this.shape.fill;k.fill();var g=Math.ceil(parseFloat(b.Util.css.getCss("s7region","border-top-width",this.targetId_,this.targetClassName_,this.overlayManager_.container)));var f=b.Util.css.getCss("s7region","border-top-color",this.targetId_,this.targetClassName_,this.overlayManager_.container);if(g>0){k.lineWidth=g;k.strokeStyle=f;k.stroke()}k.restore()}};b.MapAreaOverlay.prototype.overlayRolloverHandler_=function(h){if(((this.flags_&b.image.ImageMapEffect.ICON_FLAG)==0)&&(h.type!="keydown")){return}var g=(h.type=="mouseover"||h.type=="pointerover"||h.type=="keydown");if(this.rollover_){var e=this.overlayManager_.getLinkedOverlays(this);if(!(this.flags_&b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG)){this.setLinkedOverlaysActive(g)}if(this.mapDesc_.rolloverKey&&this.mapDesc_.rolloverKey.length&&this.rollover_==true){var k,f=this.getBounds();if(g){k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_ACTIVATED,this.mapDesc_.rolloverKey,f)}else{k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_DEACTIVATED,this.mapDesc_.rolloverKey,f)}this.overlayManager_.overlayRolloverEvent(k)}}if(g){var i=this.getRollover(this.mapDesc_);if(i!=null){var j=new b.event.UserEvent(b.event.UserEvent.ITEM,[i],true);this.overlayManager_.overlayRolloverEvent(j)}}};b.MapAreaOverlay.prototype.getRollover=function(e){if(e.rolloverKey&&e.rolloverKey.length){return e.rolloverKey}else{if(e.href&&e.href.length){return e.href}else{if(e.alt&&e.alt.length){return e.alt}}}return null};b.MapAreaOverlay.prototype.isIcon=function(){function g(i,h){if(i.x<h.x){return -1}if(i.x>h.x){return 1}return 0}var f=this.getPoints(this.mapDesc_.coords,false);f.sort(g);var e=(f.length==4&&f[0].x==f[1].x&&f[2].x==f[3].x&&(f[2].x-f[1].x)==10&&Math.abs(f[2].x-f[1].x)==Math.abs(f[0].y-f[1].y)&&Math.abs(f[1].y-f[0].y)==10&&Math.abs(f[2].y-f[3].y)==10);return e};b.MapAreaOverlay.prototype.getBounds=function(){var e=b.ImageMapUtil.getPosition(this.element_);var f=new b.Rectangle(e.x,e.y,this.element_.getWidth(),this.element_.getHeight());return f};b.MapAreaOverlay.prototype.setLinkedOverlaysActive=function(h){var f,e=this.overlayManager_.getLinkedOverlays(this);this.setActive(h);for(var g=0;g<e.length;g++){var f=e[g];if(f!=this){f.setActive(h)}}};b.MapAreaOverlay.prototype.overlayClickHandler_=function(q){this.overlayManager_.isIconActivated=false;b.image.ImageMapEffect.prototype.fixEvent(q);b.Event.preventDefault(q);b.Event.stopPropagation(q);for(var r=0;r<this.overlayManager_.mapOverlays_.length;r++){this.overlayManager_.mapOverlays_[r].element_.setAttribute("tabindex",-1)}this.element_.setAttribute("tabindex",0);this.element_.focus();if(this.rollover_==false){if(this.mapDesc_.href&&this.mapDesc_.href.length>0){var p=this.mapDesc_.href.toLowerCase();if(p.indexOf("quickview:")==0){var v=new Object();var j=this.mapDesc_.href;var m=/^QUICKVIEW:(.+)$/gi;var x=m.exec(j);var w=(x!=null&&x.length==2?x[1]:"");var g=w.split("&");for(var r=0;r<g.length;r++){var o=g[r].split("=");if(o.length>1){v[o[0]]=decodeURIComponent(g[r].split("=")[1])}}var k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.QUICKVIEW_ACTIVATED,this.mapDesc_.rolloverKey,f,this.mapDesc_.href,false,null,v);this.overlayManager_.overlayRolloverEvent(k)}else{if(p.indexOf("target:")==0){p=p.substring("target:".length);var t=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.TARGET_INDEX,this.mapDesc_.rolloverKey,f,this.mapDesc_.href,false,p);this.overlayManager_.overlayRolloverEvent(t)}else{if(p.indexOf("javascript:")==0){this.evaluateJavaScriptLink_(this.mapDesc_.href)}else{this.evaluateWebLink_(this.mapDesc_.href)}}}}else{if(this.mapDesc_.rolloverKey&&this.mapDesc_.rolloverKey.length>0){var h,f=this.getBounds(),l=this;this.setLinkedOverlaysActive(true);setTimeout(function(){l.setLinkedOverlaysActive(false)},200);h=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_ACTIVATED,this.mapDesc_.rolloverKey,f);this.overlayManager_.overlayRolloverEvent(h)}else{}}}else{if(this.mapDesc_.href&&this.mapDesc_.href.length>0){var p=this.mapDesc_.href.toLowerCase();if(p.indexOf("quickview:")==0){var v=new Object();var j=this.mapDesc_.href;var m=/^QUICKVIEW:(.+)$/gi;var x=m.exec(j);var w=(x!=null&&x.length==2?x[1]:"");var g=w.split("&");for(var r=0;r<g.length;r++){var o=g[r].split("=");if(o.length>1){v[o[0]]=decodeURIComponent(g[r].split("=")[1])}}var k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.QUICKVIEW_ACTIVATED,this.mapDesc_.rolloverKey,f,this.mapDesc_.href,false,null,v);this.overlayManager_.overlayRolloverEvent(k)}else{if(p.indexOf("target:")==0){p=p.substring("target:".length);var t=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.TARGET_INDEX,this.mapDesc_.rolloverKey,f,this.mapDesc_.href,false,p);this.overlayManager_.overlayRolloverEvent(t)}else{if(p.indexOf("javascript:")==0){this.evaluateJavaScriptLink_(this.mapDesc_.href)}else{this.evaluateWebLink_(this.mapDesc_.href)}}}}else{}}var e=this.getRollover(this.mapDesc_);if(e!=null){var n=new b.event.UserEvent(b.event.UserEvent.HREF,[e],true);this.overlayManager_.overlayRolloverEvent(n)}var u=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.HREF_ACTIVATED,null,null,this.mapDesc_.href);this.overlayManager_.overlayRolloverEvent(u)};b.MapAreaOverlay.prototype.evaluateWebLink_=function(e){window.open(e,this.mapDesc_.target||"_self")};b.MapAreaOverlay.prototype.evaluateJavaScriptLink_=function(f){if(!this.overlayManager_.enableJavaScript){return}var g=f.replace("javascript:","");var e=new Function("",g);e()};b.MapAreaOverlay.prototype.getPoints=function(k,h){h=(typeof h=="undefined")?false:h;var g=[];if(k.length%2){b.Logger.log(b.Logger.WARNING,"s7sdk.image.ImageMapEffect - s7sdk.MapAreaOverlay.getPoints - There are an odd number of coordinates!")}var f=Math.floor(k.length/2);for(var j=0;j<f;j++){var e=new b.Point2D(k[j*2],k[j*2+1]);if(h){e=this.overlayManager_.transformPoint(e)}g.push(e)}return g};b.MapAreaOverlay.prototype.processPolygon=function(h){var f=h.length;var i=0;var e=0;var l=0;for(var j=0;j<f;j++){var g=(j+1)%f;var k=h[j].x*h[g].y-h[g].x*h[j].y;i+=k;e+=(h[j].x+h[g].x)*k;l+=(h[j].y+h[g].y)*k}i*=0.5;e/=6*i;l/=6*i;return new b.ShapeInfo(new b.Point2D(e,l),Math.abs(i))};b.MapAreaOverlay.prototype.createShape=function(f){var e={};var h;e.left=e.right=f[0].x;e.top=e.bottom=f[0].y;e.points=[];for(var g=0;g<f.length;g++){var j={x:f[g].x,y:f[g].y};if(h){if(e.left>j.x){e.left=j.x}if(e.right<j.x){e.right=j.x}if(e.top>j.y){e.top=j.y}if(e.bottom<j.y){e.bottom=j.y}j.box={L:j.x>h.x?h.x:j.x,R:j.x>h.x?j.x:h.x,T:j.y>h.y?h.y:j.y,B:j.y>h.y?j.y:h.y};j.px=h.x;j.py=h.y}e.points[g]=j;h=j}e.width=e.right-e.left;e.height=e.bottom-e.top;e.px=e.right+40;e.py=e.bottom+40;e.fill=b.Util.css.getCss("s7region","background-color",this.targetId_,this.targetClassName_,this.overlayManager_.container);e.strokeStyle=b.Util.css.getCss("s7region","border-top-color",this.targetId_,this.targetClassName_,this.overlayManager_.container);e.strokeWidth=Math.ceil(parseFloat(b.Util.css.getCss("s7region","border-top-width",this.targetId_,this.targetClassName_,this.overlayManager_.container)));this.shape=e};b.MapAreaOverlay.prototype.getTransformedPoint=function(e){if(this.shape){return this.overlayManager_.transformPoint(new b.Point2D(this.shape.points[e].x,this.shape.points[e].y))}};b.MapAreaOverlay.prototype.checkMousePoint=function(e,k){if(this.shape){var h=e>this.shape.left&&e<this.shape.right&&k>this.shape.top&&k<this.shape.bottom}function j(q,v){var m={x:v.x-q.x,y:v.y-q.y};var l={x:q.px-q.x,y:q.py-q.y};var y={x:v.px-v.x,y:v.py-v.y};var p=m.x*l.y-m.y*l.x;var o=m.x*y.y-m.y*y.x;var i=l.x*y.y-l.y*y.x;if(p==0){return((v.x-q.x<0)!=(v.x-q.px<0))||((v.y-q.y<0)!=(v.y-q.py<0))}if(i==0){return false}var n=1/i;var x=o*n;var w=p*n;return(x>=0)&&(x<=1)&&(w>=0)&&(w<=1)}if(h){this.shape.x=e;this.shape.y=k;var g=0;for(var f=1;f<this.shape.points.length;f++){if(j(this.shape,this.shape.points[f])){g++}}return(g&1)==1}return false};b.MapAreaOverlay.prototype.createDiv=function(){var g=b.image.ImageMapEffect.createSmartDiv();g.style.position="absolute";g.style.backgroundRepeat="no-repeat";g.style.backgroundPosition="center";g.style.pointerEvents="auto";g.setAttribute("tabindex",0);g.setAttribute("role","button");if(this.mapDesc_.href&&this.mapDesc_.href.length>0){var f=this.mapDesc_.href.toLowerCase();var e=(this.mapDesc_.alt&&this.mapDesc_.alt.length)?this.mapDesc_.alt:"";if(f.indexOf("quickview:")==0){g.setAttribute("aria-label",b.image.ImageMapEffect.prototype.symbols.TYPE_QUICK_VIEW+" "+e)}else{if(f.indexOf("video:")==0){g.setAttribute("aria-label",b.image.ImageMapEffect.prototype.symbols.TYPE_VIDEO+" "+e)}else{if(f.indexOf("target:")==0){g.setAttribute("aria-label",b.image.ImageMapEffect.prototype.symbols.TYPE_TARGET+" "+e)}else{if(f.indexOf("javascript:")==0){g.setAttribute("aria-label",b.image.ImageMapEffect.prototype.symbols.TYPE_ACTION+" "+e);if(f.indexOf("javascript:loadproduct")==0||f.indexOf("javascript:loadproductcw")==0||f.indexOf("javascript:loadproductpw")==0){g.setAttribute("role","link")}}else{g.setAttribute("role","link");g.setAttribute("aria-label",b.image.ImageMapEffect.prototype.symbols.TYPE_LINK+" "+e)}}}}}else{if(this.mapDesc_.rolloverKey&&this.mapDesc_.rolloverKey.length>0){g.setAttribute("aria-label",b.image.ImageMapEffect.prototype.symbols.TYPE_ROLL_OVER+" "+e)}else{g.setAttribute("aria-label","")}}if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||((this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0&&this.isIcon())){g.className="s7mapoverlay s7icon";g.setWidth(parseInt(b.Util.css.getCss("s7mapoverlay s7icon","width",this.targetId_,this.targetClassName_,this.overlayManager_.container)));g.setHeight(parseInt(b.Util.css.getCss("s7mapoverlay s7icon","height",this.targetId_,this.targetClassName_,this.overlayManager_.container)))}else{g.setWidth(0);g.setHeight(0)}return g};b.ImageMapEffect=b.image.ImageMapEffect}if(!b.ImageMapUtil){b.ImageMapUtil={getPosition:function(f){var e=0;var g=0;while(f!=document){e+=f.offsetLeft;g+=f.offsetTop;f=f.parentNode}return new b.Point2D(e,g)},parseMapAreaArray:function(h){var k=new Array();for(var f=0;f<h.length;f++){var g=h[f];for(var e=0;e<g.coords.length;e++){g.coords[e]=parseInt(g.coords[e])}k.push(new b.MapDesc(g.shape,g.coords,g.alt,g.href,g.rollover_key,g.target))}return k}}}if(!b.ShapeInfo){b.ShapeInfo=function d(e,f){this.centroid=e;this.area=f}}})(s7getCurrentNameSpace());